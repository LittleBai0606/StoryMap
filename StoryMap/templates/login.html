{% load staticfiles %}
<!DOCTYPE html>
<html>
<head>
<title>登录 --StoryMap</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="Credit Login / Register Form Responsive Widget,Login form widgets, Sign up Web forms , Login signup Responsive web form,Flat Pricing table,Flat Drop downs,Registration Forms,News letter Forms,Elements" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<!-- Custom Theme files -->
<link href="{% static 'css/font-awesome.min.css' %}" rel="stylesheet" type="text/css" media="all">
<link href="{% static 'css/popuo-box.css' %}" rel="stylesheet" type="text/css" media="all" />
<link href="{% static 'css/login_style.css' %}" rel="stylesheet" type="text/css" media="all" />
<link href="{% static 'css/snow.css' %}" rel="stylesheet" type="text/css" media="all"/>

<!-- //Custom Theme files -->
<!-- web font -->
<link href="http://fonts.googleapis.com/css?family=Oswald:400,700" rel="stylesheet">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
<script src="{% static 'js/jquery-1.11.1.min.js' %}"></script>
<script src="{% static 'js/jquery.magnific-popup.js' %}" type="text/javascript"></script>
<script src="{% static 'bootstrap/js/bootstrap.min.js' %}"></script>
<script src="{% static 'js/jquery.backstretch.min.js' %}"></script>
<script src="{% static 'js/jquery.cookie.js' %}"></script>
<script src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="{% static 'js/sweetalert.js' %}"></script>

<!-- //web font -->
</head>
<body>
<div class="snow-container">
			  <div class="snow foreground"></div>
			  <div class="snow foreground layered"></div>
			  <div class="snow middleground"></div>
			  <div class="snow middleground layered"></div>
			  <div class="snow background"></div>
			  <div class="snow background layered"></div>
</div>
<h1>Story Map<span>&emsp;&emsp;分享你的旅行故事</span></h1>
<div class="main-agileits">
<!--form-stars-here-->
		<div class="form-w3-agile">
			<h2>Credit login form</h2>
			<form id="login_form">
                {% csrf_token %}
				<div class="form-sub-w3">
                    <input id="username" type="text" name="username" placeholder = "用户名或注册邮箱" value="{{ username }}">
				<div class="icon-w3">
					<i class="fa fa-user" aria-hidden="true"></i>
				</div>
				</div>
				<div class="form-sub-w3">
			        <input id="password" type="password" name="password" placeholder = "密码" value="{{ password }}">
				<div class="icon-w3">
					<i class="fa fa-unlock-alt" aria-hidden="true"></i>
				</div>
				</div>
				<p class="p-bottom-w3ls">未创建账号？<a class="w3_play_icon1" href="#small-dialog1"> 点击注册</a></p>
			</form>
            <div class="submit-w3l">
                <button type="button" onclick="loginPost()">登录</button>
            </div>
		</div>
<!--//form-ends-here-->
</div>
<div id="small-dialog1" class="mfp-hide">
					<div class="contact-form1">
										<div class="contact-w3-agileits">
										<h3>注册</h3>
											<form id="register_form">
												<div class="form-sub-w3ls">
                                                <input id="re_username" type="text" name="username" placeholder = "用户名" value="{{ username }}">
													<div class="icon-agile">
														<i class="fa fa-user" aria-hidden="true"></i>
													</div>
												</div>
												<div class="form-sub-w3ls">
                                                <input id="re_email" type="email" name="email" placeholder = "注册邮箱" value="{{ email }}">													<div class="icon-agile">
														<i class="fa fa-envelope-o" aria-hidden="true"></i>
													</div>
												</div>
												<div class="form-sub-w3ls">
			                                    <input id="re_password1" type="password" name="password1" placeholder = "密码" value="{{ password1 }}">
													<div class="icon-agile">
														<i class="fa fa-unlock-alt" aria-hidden="true"></i>
													</div>
												</div>
												<div class="form-sub-w3ls">
			                                    <input id="re_password2" type="password" name="password2" placeholder = "确认密码" value="{{ password2 }}">
													<div class="icon-agile">
														<i class="fa fa-unlock-alt" aria-hidden="true"></i>
													</div>
												</div>
                                                <div class="login-check">
								 			 <label class="checkbox"><input type="checkbox" name="checkbox" checked=""><p>I Accept Terms & Conditions</p></label>
											</div>
										</form>
                                        <div class="submit-w3l">
                                            <button type="button" onclick="registerPost()">发送验证码至邮箱</button>
                                        </div>
					</div>
				</div>
<!-- copyright -->
	<div class="copyright w3-agile">
		<p> © 2018-∞ / <a href="{% url 'index' %}" target="_blank">StoryMap开发小组</a> All rights reserved </p>
	</div>
	<!-- //copyright --> 
	<!-- pop-up-box -->
	<!--//pop-up-box -->
    <script type="text/javascript">
	var hash={
        'qq.com': 'http://mail.qq.com',
        'gmail.com': 'http://mail.google.com',
        'sina.com': 'http://mail.sina.com.cn',
        '163.com': 'http://mail.163.com',
        '126.com': 'http://mail.126.com',
        'yeah.net': 'http://www.yeah.net/',
        'sohu.com': 'http://mail.sohu.com/',
        'tom.com': 'http://mail.tom.com/',
        'sogou.com': 'http://mail.sogou.com/',
        '139.com': 'http://mail.10086.cn/',
        'hotmail.com': 'http://www.hotmail.com',
        'live.com': 'http://login.live.com/',
        'live.cn': 'http://login.live.cn/',
        'live.com.cn': 'http://login.live.com.cn',
        '189.com': 'http://webmail16.189.cn/webmail/',
        'yahoo.com.cn': 'http://mail.cn.yahoo.com/',
        'yahoo.cn': 'http://mail.cn.yahoo.com/',
        'eyou.com': 'http://www.eyou.com/',
        '21cn.com': 'http://mail.21cn.com/',
        '188.com': 'http://www.188.com/',
        'foxmail.coom': 'http://www.foxmail.com'
    }
    </script>
	<script>
		$(document).ready(function() {
		$('.w3_play_icon,.w3_play_icon1,.w3_play_icon2').magnificPopup({
			type: 'inline',
			fixedContentPos: false,
			fixedBgPos: true,
			overflowY: 'auto',
			closeBtnInside: true,
			preloader: false,
			midClick: true,
			removalDelay: 300,
			mainClass: 'my-mfp-zoom-in'
		});
																		
		});

		function validateEmail(email) {
		var re = /^[a-z0-9\.\-\_]+\@[a-z0-9\-\_]+(\.[a-z0-9\-\_]+){1,4}$/;
		return re.test(email.toLowerCase());
	}

		function registerPost() {
        var flag = 0;
        if (!document.getElementById("re_username").value) {
            swal("用户姓名不能为空", "", "error");
            flag = 1;
        }
        if (!document.getElementById("re_email").value) {
            swal("用户邮箱不能为空", "", "error");
            flag = 1;
        }
        if(!validateEmail(document.getElementById("re_email").value.trim().toLowerCase())) {
            swal("输入邮箱格式不正确", "", "error");
            flag = 1;
        }
        if (!document.getElementById("re_password1").value){
            swal("用户密码不能为空", "", "error");
            flag = 1;
        }
        if (!document.getElementById("re_password2").value){
            swal("确认密码不能为空", "", "error");
            flag = 1;
        }
        if (document.getElementById("re_password1").value != document.getElementById("re_password2").value){
            swal("两次输入密码不同", "", "error");
            flag = 1;
        }
        if(flag == 1){
            return false;
        }

        var email = document.getElementById("re_email").value.trim().toLowerCase()

        $.ajax({
            cache: false,
            type: "POST",
            url:"/register/",
            data:$('#register_form').serialize(),
            headers:{ "X-CSRFtoken":$.cookie("csrftoken")},
            dateType:"json",
            async: true,
            success: function (data) {
                if(data.status == 'success'){
                    swal ({
                        icon: "success",
                        text: "激活邮件已成功发送，请前往激活",
                        type:"success"
                    }).then(function (isConfirm) {
                        if(isConfirm === true){
                            var url = email.split('@')[1]
                            if (hash[url]){
                                window.location.href = hash[url];
                            }
                            else {
                                window.location.href = {% url 'login' %}
                            }

                        }
                    });
                }else if (data.status == 'fail'){
                    swal(data.msg, "", "error");
                }
            }
        });
    }

        function loginPost() {
        var flag = 0;
        if (!document.getElementById("username").value) {
            swal("用户姓名不能为空", "", "error");

            flag = 1;
        }
        if (!document.getElementById("password").value){
            swal("用户密码不能为空", "", "error");
            flag = 1;
        }
        if(flag == 1){
            return false;
        }
        $.ajax({
            cache: false,
            type: "POST",
            url:"/login/",
            data:$('#login_form').serialize(),
            headers:{ "X-CSRFtoken":$.cookie("csrftoken")},
            dateType:"json",
            async: true,
            success: function (data) {
                if(data.status == 'success'){
                    swal({
                        icon: "success",
                        text: "欢迎回来",
                        confirmButtonText: '进入首页',
                    }).then(function (isConfirm) {
                        if(isConfirm === true){
                            window.location.href = "{% url 'index' %}";

                        }
                    });
                }else if (data.status == 'fail'){
                    swal(data.msg, "", "error");
                }
            }
        });
    }




	</script>
</body>
</html>